"use strict";(self["webpackChunkkeydrop"]=self["webpackChunkkeydrop"]||[]).push([[228],{5228:(e,t,s)=>{s.r(t),s.d(t,{default:()=>$});var i=s(3673);const n={key:0},o=(0,i._)("div",{class:"counter-wrapper"},[(0,i._)("div",{class:"counter"}," THE END ")],-1),r=[o],l={key:1},a={class:"top-controls"},c={class:"absolute-full flex flex-center"},h={class:"absolute-full flex flex-center"},d={key:0,class:"counter-wrapper"},u={key:0,class:"counter"},y={key:1,class:"counter"},k={key:2},p=(0,i._)("div",{class:"is-error"},[(0,i._)("div",{class:"counter",style:{color:"red"}}," ! ")],-1),m=[p];function g(e,t,s,o,p,g){const w=(0,i.up)("q-badge"),b=(0,i.up)("q-linear-progress"),f=(0,i.up)("q-card-section"),v=(0,i.up)("q-card"),_=(0,i.up)("q-page-container"),x=(0,i.up)("KeydropKeyboard"),C=(0,i.up)("NormalKeyboard"),W=(0,i.up)("q-toolbar-title"),T=(0,i.up)("q-toolbar"),S=(0,i.up)("q-footer"),F=(0,i.up)("q-layout");return(0,i.wg)(),(0,i.j4)(F,{view:"hHh lpR fFf"},{default:(0,i.w5)((()=>[(0,i.Wm)(_,{class:"q-px-md"},{default:(0,i.w5)((()=>[e.gameFinished?((0,i.wg)(),(0,i.iD)("div",n,r)):((0,i.wg)(),(0,i.iD)("div",l,[(0,i._)("div",a,[(0,i.Wm)(b,{size:"30px",value:e.testProgress,color:"accent",class:"q-mt-sm"},{default:(0,i.w5)((()=>[(0,i._)("div",c,[(0,i.Wm)(w,{color:"white","text-color":"accent",label:e.testProgressLabel},null,8,["label"])])])),_:1},8,["value"]),(0,i.Wm)(b,{size:"30px",value:e.sentenceProgress,color:"accent",class:"q-mt-sm"},{default:(0,i.w5)((()=>[(0,i._)("div",h,[(0,i.Wm)(w,{color:"white","text-color":"accent",label:e.sentenceProgressLabel},null,8,["label"])])])),_:1},8,["value"])]),(0,i.Wm)(v,{flat:"",bordered:""},{default:(0,i.w5)((()=>[e.sentence&&e.sentence.length>0?((0,i.wg)(),(0,i.j4)(f,{key:0,style:{"font-size":"2em"},innerHTML:e.sentenceDisp},null,8,["innerHTML"])):(0,i.kq)("",!0)])),_:1}),e.startGameDelayCounter>=0?((0,i.wg)(),(0,i.iD)("div",d,[e.startGameDelayCounter>1?((0,i.wg)(),(0,i.iD)("div",u," Ready ")):(0,i.kq)("",!0),e.startGameDelayCounter>=0&&e.startGameDelayCounter<=1?((0,i.wg)(),(0,i.iD)("div",y," GO! ")):(0,i.kq)("",!0)])):(0,i.kq)("",!0)])),e.isError?((0,i.wg)(),(0,i.iD)("div",k,m)):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(S,{class:"footer"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,null,{default:(0,i.w5)((()=>[(0,i.Wm)(W,null,{default:(0,i.w5)((()=>["keydrop"==e.gamemode?((0,i.wg)(),(0,i.j4)(x,{key:0,ref:"keydropKeyboard",modelValue:e.text,"onUpdate:modelValue":t[0]||(t[0]=t=>e.text=t),onKeypressed:t[1]||(t[1]=t=>e.logKey(t)),onWordpressed:t[2]||(t[2]=t=>e.logWord(t))},null,8,["modelValue"])):((0,i.wg)(),(0,i.j4)(C,{key:1,ref:"normalKeyboard",modelValue:e.text,"onUpdate:modelValue":t[3]||(t[3]=t=>e.text=t),onKeypressed:t[4]||(t[4]=t=>e.logKey(t)),onWordpressed:t[5]||(t[5]=t=>e.logWord(t))},null,8,["modelValue"]))])),_:1})])),_:1})])),_:1})])),_:1})}s(71),s(3985);var w=s(2008),b=s(2323);const f={class:"kb-row kb-row-first"},v=["value"],_=["value"],x=["value"],C=["onMousedown","onMouseup","onMouseleave","onTouchstart","onTouchend","onTouchcancel"];function W(e,t,s,n,o,r){return(0,i.wg)(),(0,i.iD)("div",null,[(0,i._)("div",f,[(0,i._)("input",{class:"",style:{"background-color":"transparent","box-shadow":"none",border:"0"},type:"button",value:e.leftWord,onClick:t[0]||(t[0]=t=>e.insertWord(e.leftWord))},null,8,v),(0,i._)("input",{class:"",style:{"background-color":"transparent","box-shadow":"none",border:"0"},type:"button",value:e.inp,onClick:t[1]||(t[1]=()=>{e.$emit("wordpressed",e.inp),e.insertWord(e.inp)})},null,8,_),(0,i._)("input",{class:"",style:{"background-color":"transparent","box-shadow":"none",border:"0"},type:"button",value:e.rightWord,onClick:t[2]||(t[2]=t=>e.insertWord(e.rightWord))},null,8,x)]),((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.boardView,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t,class:"kb-row"},[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t,class:(0,b.C_)(["btn",[t.class,{original:t.original_show}]]),style:(0,b.j5)([{position:"relative"},t.style]),onMousedown:s=>e.original_mousedown(t),onMouseup:s=>e.original_mouseup(t),onMouseleave:s=>e.original_mouseleave(t),onTouchstart:s=>e.original_touchstart(t),onTouchend:s=>e.original_touchend(t),onTouchcancel:s=>e.original_touchcancel(t)},[(0,i.Uk)((0,b.zw)(t.label.toUpperCase())+" ",1),(0,i._)("div",{class:"btn-original",style:(0,b.j5)({display:t.key==t.original_key?"none":"block"})},(0,b.zw)(t.original_label),5)],46,C)))),128))])))),128))])}s(7386),s(7070);s(52);const T=(0,i.aZ)({name:"NormalKeyboard",props:{modelValue:String},components:{},setup(){return{}},watch:{modelValue(e){let t=e.lastIndexOf(" "),s=(e.lastIndexOf("."),e.lastIndexOf(","),e.lastIndexOf("\n")),i=Math.max(s,t);-1==i?(this.internal_text="",this.internal_inp=e):i==e.length-1?this.internal_text=e:(this.internal_text=e.substring(0,i+1),this.internal_inp=e.substring(i+1,e.length)),this.updateBoard()}},data(){return{internal_inp:"",internal_text:"",leftWord:"",rightWord:"",keys:{},boardView:[],tree:{},key_timeouts:{}}},computed:{fullText:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},text:{get(){return this.internal_text},set(e){this.internal_text=e,this.fullText=this.internal_text+this.inp}},inp:{get(){return this.internal_inp},set(e){this.internal_inp=e,this.fullText=this.text+this.internal_inp}},row0:function(){return Object.fromEntries(Object.entries(this.keys).filter((([e,t])=>0==t.row)))},row1:function(){return Object.fromEntries(Object.entries(this.keys).filter((([e,t])=>1==t.row)))},row2:function(){return Object.fromEntries(Object.entries(this.keys).filter((([e,t])=>2==t.row)))},row3:function(){return Object.fromEntries(Object.entries(this.keys).filter((([e,t])=>3==t.row)))}},created(){this.board=[[{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0}],[{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0}],[{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0}],[{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0},{key:void 0}]],this.key_positions={q:{row:0,col:0},w:{row:0,col:1},e:{row:0,col:2},r:{row:0,col:3},t:{row:0,col:4},y:{row:0,col:5},u:{row:0,col:6},i:{row:0,col:7},o:{row:0,col:8},p:{row:0,col:9},a:{row:1,col:0},s:{row:1,col:1},d:{row:1,col:2},f:{row:1,col:3},g:{row:1,col:4},h:{row:1,col:5},j:{row:1,col:6},k:{row:1,col:7},l:{row:1,col:8},shift:{row:2,col:0},z:{row:2,col:1},x:{row:2,col:2},c:{row:2,col:3},v:{row:2,col:4},b:{row:2,col:5},n:{row:2,col:6},m:{row:2,col:7},backspace:{row:2,col:8},numeric:{row:3,col:0},",":{row:3,col:1},emoji:{row:3,col:2}," ":{row:3,col:3},".":{row:3,col:4},"\n":{row:3,col:5}},this.key_style={q:{class:"btn-row1",style:""},w:{class:"btn-row1",style:""},e:{class:"btn-row1",style:""},r:{class:"btn-row1",style:""},t:{class:"btn-row1",style:""},y:{class:"btn-row1",style:""},u:{class:"btn-row1",style:""},i:{class:"btn-row1",style:""},o:{class:"btn-row1",style:""},p:{class:"btn-row1",style:""},a:{class:"btn-row2",style:"margin-left: 10pt;"},s:{class:"btn-row2",style:""},d:{class:"btn-row2",style:""},f:{class:"btn-row2",style:""},g:{class:"btn-row2",style:""},h:{class:"btn-row2",style:""},j:{class:"btn-row2",style:""},k:{class:"btn-row2",style:""},l:{class:"btn-row2",style:"margin-right: 10pt;"},shift:{class:"btn-shift",style:""},z:{class:"btn-row3",style:""},x:{class:"btn-row3",style:""},c:{class:"btn-row3",style:""},v:{class:"btn-row3",style:""},b:{class:"btn-row3",style:""},n:{class:"btn-row3",style:""},m:{class:"btn-row3",style:""},backspace:{class:"btn-shift",style:""},numeric:{class:"btn-shift",style:""},",":{class:"btn-row4",style:""},emoji:{class:"btn-row4",style:""}," ":{class:"btn-space",style:""},".":{class:"btn-row4",style:""},"\n":{class:"btn-shift",style:""}},this.key_labels={q:"q",w:"w",e:"e",r:"r",t:"t",y:"y",u:"u",i:"i",o:"o",p:"p",a:"a",s:"s",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",l:"l",shift:"⇧",z:"z",x:"x",c:"c",v:"v",b:"b",n:"n",m:"m",backspace:"⌫",numeric:"",",":",",emoji:"🙂"," ":"_",".":".","\n":"⏎"},this.key_actions={q:this.keyFunWraper(this.keyClicked),w:this.keyFunWraper(this.keyClicked),e:this.keyFunWraper(this.keyClicked),r:this.keyFunWraper(this.keyClicked),t:this.keyFunWraper(this.keyClicked),y:this.keyFunWraper(this.keyClicked),u:this.keyFunWraper(this.keyClicked),i:this.keyFunWraper(this.keyClicked),o:this.keyFunWraper(this.keyClicked),p:this.keyFunWraper(this.keyClicked),a:this.keyFunWraper(this.keyClicked),s:this.keyFunWraper(this.keyClicked),d:this.keyFunWraper(this.keyClicked),f:this.keyFunWraper(this.keyClicked),g:this.keyFunWraper(this.keyClicked),h:this.keyFunWraper(this.keyClicked),j:this.keyFunWraper(this.keyClicked),k:this.keyFunWraper(this.keyClicked),l:this.keyFunWraper(this.keyClicked),shift:this.keyFunWraper(this.shiftClicked),z:this.keyFunWraper(this.keyClicked),x:this.keyFunWraper(this.keyClicked),c:this.keyFunWraper(this.keyClicked),v:this.keyFunWraper(this.keyClicked),b:this.keyFunWraper(this.keyClicked),n:this.keyFunWraper(this.keyClicked),m:this.keyFunWraper(this.keyClicked),backspace:this.keyFunWraper(this.backspaceClicked),numeric:this.keyFunWraper(this.numClicked),",":this.keyFunWraper(this.commaClicked),emoji:this.keyFunWraper(this.keyClicked)," ":this.keyFunWraper(this.spaceClicked),".":this.keyFunWraper(this.dotClicked),"\n":this.keyFunWraper(this.enterClicked)},this.standard_keys=["shift","backspace","numeric",",","emoji"," ",".","\n"]},mounted(){this.updateBoard()},methods:{original_leave:function(e){e.original_show=!1,clearTimeout(this.key_timeouts[e])},original_down:function(e){e.key!=e.original_key?this.key_timeouts[e]=setTimeout((()=>{e.original_show=!0}),500):"backspace"==e.key&&(this.key_timeouts[e]=setTimeout((()=>{this.key_timeouts[e]=setInterval((()=>{this.backspaceClicked(e)}),50)}),500))},original_up:function(e){e.original_show?e.original_action(Object.assign(Object.assign({},e),{label:e.original_label,key:e.original_key,action:e.original_action})):("backspace"==e.key&&clearTimeout(this.key_timeouts[e]),e.action(e))},original_mouseleave:function(e){if(this.$q.platform.is.mobile)return!1;this.original_leave(e)},original_mousedown:function(e){if(this.$q.platform.is.mobile)return!1;this.original_down(e)},original_mouseup:function(e){if(this.$q.platform.is.mobile)return!1;this.original_up(e)},original_touchstart:function(e){this.original_down(e)},original_touchend:function(e){this.original_up(e)},original_touchcancel:function(e){this.original_leave(e)},showNotSupported:function(){this.$q.notify({type:"info",timeout:100,message:"Not supported"})},shiftClicked:function(e){this.showNotSupported()},numClicked:function(e){this.showNotSupported()},spaceClicked:function(e){this.insertWord(this.inp)},dotClicked:function(e){this.insertWord(this.inp+".")},commaClicked:function(e){this.insertWord(this.inp+",")},enterClicked:function(e){this.insertWord(this.inp,"\n")},keyFunWraper:function(e){return t=>{e(t),this.$emit("keypressed",t)}},backspaceClicked:function(e){if(this.inp.length>0)this.inp=this.inp.substring(0,this.inp.length-1),this.updateBoard();else{" "!=this.text[this.text.length-1]&&"."!=this.text[this.text.length-1]&&","!=this.text[this.text.length-1]&&"\n"!=this.text[this.text.length-1]||(this.text=this.text.substring(0,this.text.length-1));let e=this.text.split(" "),t=e.length;this.text=t>1?e.slice(0,t-1).join(" ")+" ":"",this.inp=e[t-1]}},keyClicked:function(e){this.inp=this.inp+e.label,this.updateBoard()},insertWord:function(e,t=" "){this.text+=e+t,this.inp="",this.rightWord="",this.leftWord="",this.updateBoard()},updateBoard:function(){let e=(e,t)=>{for(let s in this.key_positions){let i=this.key_positions[s].row,n=this.key_positions[s].col;if(i==e&&n==t)return s}throw"ERROR: cannot find"},t=Object.keys(this.key_actions),s=(this.map_keys(t).reverse(),this.board.map((e=>[...e])));for(let i=0;i<s.length;i++)for(let t=0;t<s[i].length;t++){let n=s[i][t];if(void 0==n||void 0==n.key||void 0==n.label){let n=e(i,t);s[i][t]={row:i,col:t,original_key:n,original_label:this.key_labels[n],original_action:this.key_actions[n],key:n,label:this.key_labels[n],style:this.key_style[n].style,class:this.key_style[n].class,action:this.key_actions[n]}}}Object.assign(this.boardView,s)},zip:function(e,t,s={}){return e.map(((e,i)=>{s[e]=t[i]})),s},reset:function(){this.inp="",this.text=""},map_keys:function(e){return e.map((e=>({row:this.key_positions[e].row,col:this.key_positions[e].col,original_key:e,original_label:this.key_labels[e],original_action:this.key_actions[e],key:e,label:this.key_labels[e],style:this.key_style[e].style,class:this.key_style[e].class,action:this.key_actions[e]})))},findSimilar:function(e){let t=this.wordsLeft;this.lettersLeft;t.size>0?this.leftWord=t[0]:this.leftWord="",t.size>1?this.rightWord=t[1]:this.rightWord=""}}});T.render=W;const S=T,F=(s(52),(0,i.aZ)({name:"MainLayout",components:{KeydropKeyboard:w.Z,NormalKeyboard:S},setup(){return{}},data(){return{text:"",startGameDelayCounter:3,startGameDelayInterval:void 0,refreshControlsInterval:void 0,sentenceIdx:-1,pressedKeys:[],completedSentences:[],gameFinished:!1,startTime:0,gameTimeStart:0,gameTimeStop:0,sentenceTimeStart:0,sentenceTimeStop:0,sentenceTimeElapsed:0,testTimeElapsed:0,sentence:void 0,gamemode:void 0}},computed:{viewportHeight:function(){return this.$q.screen.height-this.getFooterSize()},testProgressLabel:function(){return"Test progress: 🕑 "+this.testTimeDisp+"s | "+(this.sentenceIdx>-1?this.sentenceIdx:0)+"/"+this.sentences.length+" ("+(100*this.testProgress).toFixed(0)+"%)"},testProgress:function(){return this.sentenceIdx>-1?this.sentenceIdx/this.sentences.length:0},sentenceProgressLabel:function(){return"Round progress: 🕑 "+this.sentenceTimeDisp+"s | "+(100*this.sentenceProgress).toFixed(0)+"%"},sentenceProgress:function(){return this.sentence?this.correctCharacters()/this.sentence.length:0},testTimeDisp:function(){return this.testTimeElapsed?this.testTimeElapsed.toFixed(1):0},sentenceTimeDisp:function(){return this.sentenceTimeElapsed?this.sentenceTimeElapsed.toFixed(1):0},isError:function(){return this.correctCharacters()<this.text.length},sentenceDisp:function(){let e=this.sentence.toLowerCase(),t=this.text.toLowerCase(),s='<span style="color:black; background-color:lightgreen;">',i=this.correctCharacters();return s+=e.substr(0,i)+"</span>",i<t.length&&(s+='<span style="background-color:red">'+e.substr(i,t.length-i)+"</span>",i=t.length),s+='<span style="color:#aaa">'+e.substr(i,e.length-i)+"</span>",s}},deactivated(){},unmounted(){console.log("unmounted"),this.resetState()},created(){var e;this.gamemode=null!==(e=this.$route.params.mode)&&void 0!==e?e:"keydrop",this.sentences=["this is","the","here"],this.startGameDelayCounter=3,this.gameFinished=!1,this.pressedKeys=[],this.sentenceIdx=-1,this.gameTimeStart=void 0,this.gameTimeStop=void 0,this.sentenceTimeStart=void 0,this.sentenceTimeStop=void 0,this.sentenceTimeElapsed=0,this.testTimeElapsed=0,this.completedSentences=[],this.refreshControlsInterval=setInterval((()=>{this.refreshControls()}),100),this.startGameDelayInterval=setInterval((()=>{this.startGameDelayCounter--,this.startGameDelayCounter<0&&(clearInterval(this.startGameDelayInterval),this.gameStart())}),1e3)},mounted(){},methods:{correctCharacters:function(){if(void 0==this.sentence||void 0==this.text)return 0;let e=this.sentence.toLowerCase(),t=this.text.toLowerCase(),s=0;while(e[s]==t[s]&&s<e.length&&s<t.length)s++;return s},resetKeyboard:function(){for(let e of[this.$refs.keyboard,this.$refs.keydropKeyboard,this.$refs.normalKeyboard])void 0!=e&&e.reset()},refreshControls:function(){this.sentenceTimeElapsed=(Date.now()-this.sentenceTimeStart)/1e3,this.testTimeElapsed=(Date.now()-this.gameTimeStart)/1e3},nextSentence:function(){this.sentenceIdx>-1&&(this.sentenceTimeStop=Date.now(),this.completedSentences.push({sentence:this.sentence,text:this.text,idx:this.sentenceIdx,startTime:this.sentenceTimeStart,endTime:this.sentenceTimeStop,pressedKeys:this.pressedKeys})),this.pressedKeys=[],this.sentenceTimeStop=void 0,this.sentenceTimeStart=void 0,this.resetKeyboard(),this.sentenceIdx<this.sentences.length-1?(this.sentenceIdx++,this.sentence=this.sentences[this.sentenceIdx],this.sentenceTimeStart=Date.now()):(this.gameFinished=!0,this.gameEnd())},logKey:function(e){this.pressedKeys.push({key:{key:e.key,label:e.label,original_key:e.original_key,original_label:e.original_label},expected_key:this.sentence[this.text.length-1],position:this.text.length-1,correct:!this.isError&&e.key==this.sentence[this.text.length-1],time:Date.now()}),this.text.toLowerCase()==this.sentence.toLowerCase()&&this.nextSentence()},logTestScore:function(){let e=localStorage.getItem("tests");e=void 0==e?[]:JSON.parse(e),e.push({mode:this.gamemode,startTime:this.gameTimeStart,endTime:this.gameTimeStop,sentences:Object.assign([],this.completedSentences)}),localStorage.setItem("tests",JSON.stringify(e)),this.gameTimeStart=void 0,this.gameTimeStop=void 0,this.completedSentences=void 0},resetState:function(){console.log("resetState"),clearInterval(this.refreshControlsInterval),clearInterval(this.startGameDelayInterval),this.gameFinished=!1},gameEnd:function(){console.log("gameEnd"),1==this.gameFinished&&(console.log("gameEnd inside if"),this.gameTimeStop=Date.now(),this.logTestScore(),setTimeout((()=>{this.resetState(),this.$router.push("/")}),2e3))},gameStart:function(){this.gameTimeStart=Date.now(),this.nextSentence()},getFooterSize:function(){return document.getElementsByClassName("q-footer")[0].getBoundingClientRect().height}}}));var D=s(3066),j=s(2652),I=s(1598),q=s(9721),K=s(151),E=s(5589),O=s(1762),L=s(9570),z=s(3747),G=s(7518),V=s.n(G);F.render=g;const $=F;V()(F,"components",{QLayout:D.Z,QPageContainer:j.Z,QLinearProgress:I.Z,QBadge:q.Z,QCard:K.Z,QCardSection:E.Z,QFooter:O.Z,QToolbar:L.Z,QToolbarTitle:z.Z})}}]);